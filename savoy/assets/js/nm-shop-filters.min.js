/* NM: Shop filters script */
!function(e){"use strict";e.extend(e.nmTheme,{filters_init:function(){var o=this;o.$shopFilterMenu=e("#nm-shop-filter-menu"),o.$shopSidebarPopupBtn=e("#nm-shop-sidebar-popup-button"),o.shopSidebarLayout=e("#nm-shop-sidebar").data("sidebar-layout"),o.filterPanelSliding=!1,o.filterPanelSlideSpeed=200,o.filterPanelHideWidth=551,o.shopFilterMenuFnNames={cat:"shopFiltersCategoriesToggle",filter:"shopFiltersSidebarToggle",sidebar:"shopDefaultSidebarToggle",search:"shopFiltersSearchToggle"},o.shopFiltersBind()},shopFiltersBind:function(){var o=this;if(o.filtersEnableAjax&&o.$header.on("click.nmHeaderShopAjax",".shop-ajax-link > a",(function(s){s.preventDefault();var t=e(this),i=t.parents(".menu-item").last();i.addClass("no-hover"),o.shopFiltersSearchClose(),e("#nm-shop-categories-wrap").find(".current-cat").removeClass("current-cat");var a=o.shopScrollToTop();setTimeout((function(){o.shopGetPage(t.attr("href")),setTimeout((function(){i.removeClass("no-hover")}),100)}),a)})),o.$shopFilterMenu.find("a").on("click",(function(s){if(s.preventDefault(),!o.filterPanelSliding){o.shopRemoveNotices(),o.filterPanelSliding=!0;var t=0,i=e(this).parent("li"),a=i.data("panel");i.hasClass("active")||(t=o.shopFiltersHideActivePanel()),i.toggleClass("active"),setTimeout((function(){var e=o.shopFilterMenuFnNames[a];o[e]()}),t)}})),o.filtersEnableAjax&&o.$pageIncludes.hasClass("shop_categories")&&o.$shopWrap.on("click","#nm-shop-categories-wrap a",(function(s){s.preventDefault();var t=e(this),i=t.parent("li");o.shopFiltersSearchClose(),e("#nm-shop-categories-wrap").find(".current-cat").removeClass("current-cat"),i.addClass("current-cat"),o.shopGetPage(t.attr("href"))})),o.$shopSidebarPopupBtn.length){o.$shopSidebarPopup=e("#nm-shop-sidebar-popup");var s=null;o.$window.on("scroll.nmShopPopupBtn resize.nmShopPopupBtn",(function(){s&&clearTimeout(s),s=setTimeout((function(){o.$body.hasClass("shop-filters-popup-open")||o.shopFiltersPopupButtonToggle()}),500)})),o.$shopSidebarPopupBtn.on("click",(function(){o.shopFiltersPopupShow()})),e("#nm-shop-sidebar-popup-reset-button").on("click",(function(e){e.preventDefault(),o.shopFiltersPopupReset()})),e("#nm-shop-sidebar-popup-close-button").on("click",(function(e){e.preventDefault(),o.shopFiltersPopupHide()}))}var t=!o.isTouch,i=!1;o.$shopWrap.on("click","#nm-shop-sidebar .nm-widget-title",(function(s){var a=e(this).closest("li");if(a.hasClass("show"))t&&a.children(".nm-shop-widget-col").last().css("height",""),a.removeClass("show");else{var r=a.parent("#nm-shop-widgets-ul").children(".show");if(t){var n=a.children(".nm-shop-widget-col").last(),p=n.children().first().outerHeight(!0)+"px",l=r.children(".nm-shop-widget-col").last();n.css("height",p),l.css("height",""),i||(i=!0,o.$window.one("resize.nmShopWidget",(function(){o.shopFiltersWidgetHideOpen(),i=!1})))}r.removeClass("show"),a.addClass("show")}})),o.filtersEnableAjax&&o.$pageIncludes.hasClass("shop_filters")&&(o.$shopWrap.on("click","#nm-shop-sidebar .nm_widget a",(function(s){s.preventDefault(),o.shopGetPage(e(this).attr("href"))})),o.$shopWrap.on("click","#nm-shop-sidebar .widget_product_categories a",(function(s){s.preventDefault(),o.shopGetPage(e(this).attr("href"))})),o.$shopWrap.on("click","#nm-shop-sidebar .widget_layered_nav a",(function(s){s.preventDefault(),o.shopGetPage(e(this).attr("href"))})),o.$document.on("nm_ajax_shop_update_content",(function(){o.$shopWrap.on("change","#nm-shop-sidebar select.woocommerce-widget-layered-nav-dropdown",(function(){var o=e(this),s=o.closest("form"),t=o.val(),i=o.attr("class"),a=i.substr(i.lastIndexOf("_")+1),r=s.find('input[name="filter_'+a+'"]');r.length&&(r.val(t),o.attr("multiple")||s.submit())}))})),o.$shopWrap.on("click","#nm-shop-sidebar .widget_layered_nav_filters a",(function(s){s.preventDefault(),o.shopGetPage(e(this).attr("href"))})),o.$shopWrap.on("click","#nm-shop-sidebar .widget_product_tag_cloud a",(function(s){s.preventDefault(),o.shopGetPage(e(this).attr("href"),!1,!0)})),o.$shopWrap.on("click","#nm-shop-sidebar .widget_rating_filter a",(function(s){s.preventDefault(),o.shopGetPage(e(this).attr("href"))})),o.$body.on("price_slider_change",(function(s,t,i){var a=e("#nm-shop-sidebar").find(".widget_price_filter").first().find("form"),r=parseInt(a.find("#min_price").attr("value")),n=parseInt(a.find("#max_price").attr("value"));if(r!=t||n!=i){var p=a.attr("action")+"?"+a.serialize();o.shopGetPage(p)}}))),o.filtersEnableAjax&&o.$pageIncludes.hasClass("shop_filters")&&o.$shopWrap.on("click.nmShopIndividualFilterReset",".nm-shop-results-bar a:not(.nm-shop-reset-button)",(function(s){s.preventDefault(),o.shopGetPage(e(this).attr("href"))}))},shopFiltersCategoriesToggle:function(){var o=this,s=e("#nm-shop-categories-wrap"),t=s.is(":visible");t&&s.removeClass("fade-in"),s.slideToggle(o.filterPanelSlideSpeed,(function(){t?s.removeClass("force-show").css("display",""):s.addClass("fade-in"),o.filterPanelSliding=!1}))},shopFiltersCategoriesReset:function(){e("#nm-shop-categories-wrap").removeClass("fade-in force-show").css("display","")},shopFiltersSidebarToggle:function(){var o=this,s=e("#nm-shop-sidebar"),t=s.is(":visible");t&&s.removeClass("fade-in"),s.slideToggle(o.filterPanelSlideSpeed,(function(){t||s.addClass("fade-in"),o.filterPanelSliding=!1}))},shopFiltersWidgetHideOpen:function(){var o=e("#nm-shop-widgets-ul").children(".show");o.length&&o.find(".nm-widget-title").trigger("click")},shopDefaultSidebarToggle:function(){var o=this,s=e("#nm-shop-sidebar"),t=s.is(":visible");t&&s.removeClass("fade-in"),s.slideToggle(o.filterPanelSlideSpeed,(function(){t||s.addClass("fade-in"),o.filterPanelSliding=!1}))},shopFiltersSearchToggle:function(){this.shopSearchTogglePanel(),this.currentSearch=""},shopFiltersSearchClose:function(){var e=this;e.searchEnabled&&e.$searchBtn.parent("li").hasClass("active")&&(e.categoryClicked=!0,e.$searchBtn.trigger("click"))},shopFiltersHideActivePanel:function(){var e=this,o=0,s=e.$shopFilterMenu.children(".active");if(s.length){s.removeClass("active");var t=s.data("panel");if(s.is(":hidden")&&"cat"==t)e.shopFiltersCategoriesReset();else o=300,e[e.shopFilterMenuFnNames[t]]()}return o},shopFiltersPopupButtonToggle:function(){var e=this;(e.$shopSidebarPopupBtn.hasClass("visible")?e.$shopSidebarPopupBtn.offset().top+e.$shopSidebarPopupBtn.outerHeight(!0):e.$shopSidebarPopupBtn.offset().top)>e.$shopBrowseWrap.offset().top+190?e.shopFiltersPopupButtonShow():e.shopFiltersPopupButtonHide()},shopFiltersPopupButtonShow:function(){this.$shopSidebarPopupBtn.addClass("visible")},shopFiltersPopupButtonHide:function(){this.$shopSidebarPopupBtn.removeClass("visible")},shopFiltersPopupShow:function(){var e=this;e.shopFiltersPopupButtonHide(),e.$shopSidebarPopup.addClass("visible"),e.$body.addClass("shop-filters-popup-open"),e.pageOverlayShow(),e.$document.on("mouseup.filtersPopup",(function(o){e.$shopSidebarPopup.is(o.target)||0!==e.$shopSidebarPopup.has(o.target).length||e.shopFiltersPopupHide()}))},shopFiltersPopupHide:function(){var e=this;e.$shopSidebarPopup.removeClass("visible"),e.shopFiltersPopupButtonToggle(),e.$body.removeClass("shop-filters-popup-open"),e.$document.off("mouseup.filtersPopup"),e.pageOverlayHide(),setTimeout((function(){e.searchHideNotice()}),e.panelsAnimSpeed)},shopFiltersPopupReset:function(){var e=location.href.replace(location.search,"");this.shopGetPage(e),"0"!==nm_wp_vars.shopFiltersPopupAutoClose&&this.shopFiltersPopupHide()},shopExternalGetPage:function(o){var s=this;if(o==window.location.href)s.shopScrollToTop();else{e("#nm-shop-categories-wrap").find(".current-cat").removeClass("current-cat");var t=s.shopScrollToTop();setTimeout((function(){s.shopGetPage(o)}),t)}},shopGetPage:function(o,s,t){var i=this;if(i.shopAjax)return!1;if(o){if(i.shopRemoveNotices(),"popup"==i.shopSidebarLayout&&"0"!==nm_wp_vars.shopFiltersPopupAutoClose&&i.shopFiltersPopupHide(),i.$body.width()<i.filterPanelHideWidth){i.shopShowLoader(!0);var a=i.filterPanelSlideSpeed;i.filterPanelSlideSpeed=0,"0"!==nm_wp_vars.shopFiltersMobileAutoClose&&i.shopFiltersHideActivePanel(),i.filterPanelSlideSpeed=a}else i.shopShowLoader();o=o.replace(/\/?(\?|#|$)/,"/$1"),s||i.setPushState(o),i.shopAjax=e.ajax({url:o,data:{shop_load:"full",shop_filters_layout:i.shopSidebarLayout},dataType:"html",cache:!1,headers:{"cache-control":"no-cache"},method:"POST",error:function(e,o,s){console.log("NM: AJAX error - shopGetPage() - "+s),i.shopHideLoader(),i.shopAjax=!1},success:function(e){i.shopUpdateContent(e),i.shopAjax=!1}})}},shopUpdateContent:function(o){var s=this,t=e("<div>"+o+"</div>");if(nm_wp_vars.shopAjaxUpdateTitle){var i=t.find("#nm-wp-title").text();i.length&&(document.title=i)}var a=t.find("#nm-body-class"),r=t.find("#nm-shop-taxonomy-header"),n=t.find(".nm-shop-taxonomy-heading"),p=t.find("#nm-shop-categories-wrap"),l=t.find("#nm-shop-widgets-ul"),c=t.find("#nm-shop-browse-wrap");if(a.hasClass("post-type-archive")?s.$body.removeClass("tax-product_cat tax-product_tag").addClass("post-type-archive post-type-archive-product"):a.hasClass("tax-product_cat")?s.$body.removeClass("post-type-archive post-type-archive-product tax-product_tag").addClass("tax-product_cat"):a.hasClass("tax-product_tag")&&s.$body.removeClass("post-type-archive post-type-archive-product tax-product_cat").addClass("tax-product_tag"),r.length){var h=e("#nm-shop-taxonomy-header");h.replaceWith(r),h.removeClass("hidden")}else e("#nm-shop-taxonomy-header").addClass("hidden");if(n.length?e(".nm-shop-taxonomy-heading").replaceWith(n):e(".nm-shop-taxonomy-heading").addClass("hidden"),p.length){var d=e("#nm-shop-categories-wrap");d.hasClass("fade-in")&&p.addClass("fade-in force-show"),d.replaceWith(p)}(l.length&&(e("#nm-shop-widgets-ul").replaceWith(l),s.shopFiltersInitPriceSlider()),c.length&&s.$shopBrowseWrap.replaceWith(c),s.$document.trigger("nm_ajax_shop_update_content",t),s.$shopBrowseWrap=e("#nm-shop-browse-wrap"),void 0!==s.shopInfLoadBound&&s.shopInfLoadBound)||Object.getPrototypeOf(s).hasOwnProperty("infload_init")&&s.infload_init();if(s.$body.hasClass("nm-shop-scroll-enabled")){var u=s.shopScrollToTop();setTimeout((function(){s.shopHideLoader()}),u)}else s.shopHideLoader()},shopFiltersInitPriceSlider:function(){if("undefined"==typeof woocommerce_price_slider_params)return!1;e(document.body).on("price_slider_create price_slider_slide",(function(o,s,t){e(".price_slider_amount span.from").html(accounting.formatMoney(s,{symbol:woocommerce_price_slider_params.currency_format_symbol,decimal:woocommerce_price_slider_params.currency_format_decimal_sep,thousand:woocommerce_price_slider_params.currency_format_thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:woocommerce_price_slider_params.currency_format})),e(".price_slider_amount span.to").html(accounting.formatMoney(t,{symbol:woocommerce_price_slider_params.currency_format_symbol,decimal:woocommerce_price_slider_params.currency_format_decimal_sep,thousand:woocommerce_price_slider_params.currency_format_thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:woocommerce_price_slider_params.currency_format})),e(document.body).trigger("price_slider_updated",[s,t])})),function(){e("input#min_price, input#max_price").hide(),e(".price_slider, .price_label").show();var o=e(".price_slider_amount #min_price").data("min"),s=e(".price_slider_amount #max_price").data("max"),t=e(".price_slider_amount").data("step")||1,i=e(".price_slider_amount #min_price").val(),a=e(".price_slider_amount #max_price").val();e(".price_slider:not(.ui-slider)").slider({range:!0,animate:!0,min:o,max:s,step:t,values:[i,a],create:function(){e(".price_slider_amount #min_price").val(i),e(".price_slider_amount #max_price").val(a),e(document.body).trigger("price_slider_create",[i,a])},slide:function(o,s){e("input#min_price").val(s.values[0]),e("input#max_price").val(s.values[1]),e(document.body).trigger("price_slider_slide",[s.values[0],s.values[1]])},change:function(o,s){e(document.body).trigger("price_slider_change",[s.values[0],s.values[1]])}})}()}}),e.nmThemeExtensions.filters=e.nmTheme.filters_init}(jQuery);