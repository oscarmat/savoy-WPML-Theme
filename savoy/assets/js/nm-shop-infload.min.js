/* NM: Shop infinite load script */
!function(o){"use strict";o.extend(o.nmTheme,{infload_init:function(){var o=this.$shopBrowseWrap.children(".nm-pagination");o.length&&o.hasClass("nm-infload")&&this.shopInfLoadBind()},shopInfLoadBind:function(){var n=this,e=o("#nm-shop-products"),r=n.$shopBrowseWrap.children(".nm-infload-controls");if(n.shopInfLoadBound=!0,n.infloadScroll=!!r.hasClass("scroll-mode"),n.infloadScroll){n.infscrollLock=!1;var l=Math.round(n.$document.height()-r.offset().top),a=parseInt(nm_wp_vars.infloadBuffer),s=null;n.$window.off("resize.nmInfLoad").on("resize.nmInfLoad",(function(){s&&clearTimeout(s),s=setTimeout((function(){var o=n.$shopBrowseWrap.children(".nm-infload-controls");o.length&&(l=Math.round(n.$document.height()-o.offset().top))}),100)})),n.$window.off("smartscroll.infscroll").on("smartscroll.infscroll",(function(){n.infscrollLock||0+n.$document.height()-n.$window.scrollTop()-n.$window.height()-a<l&&n.shopInfLoadGetPage()}))}else e.on("click",".nm-infload-btn",(function(o){o.preventDefault(),n.shopInfLoadGetPage()}));e.on("click",".nm-infload-to-top",(function(o){o.preventDefault(),n.shopScrollToTop()})),n.infloadScroll&&n.$window.trigger("scroll")},shopInfLoadGetPage:function(){var n=this;if(n.shopAjax)return!1;n.shopRemoveNotices();var e,r=n.$shopBrowseWrap.children(".nm-infload-link").find("a"),l=n.$shopBrowseWrap.children(".nm-infload-controls"),a=l.children(".nm-infload-controls-button"),s=r.attr("href");s?(s=n.updateUrlParameter(s,"shop_load","products"),l.addClass("loading"),a.addClass("nm-loader"),n.$document.trigger("nm_infload_before",s),n.shopAjax=o.ajax({url:s,dataType:"html",cache:!1,headers:{"cache-control":"no-cache"},method:"GET",error:function(o,n,e){console.log("NM: AJAX error - shopInfLoadGetPage() - "+e)},complete:function(){l.removeClass("loading"),a.removeClass("nm-loader")},success:function(a){var i=o("<div>"+a+"</div>"),t=i.children(".nm-products").children("li");t.addClass("hide"),e=n.$document.scrollTop(),n.$shopBrowseWrap.find(".nm-products:first").append(t),"0"!=nm_wp_vars.infloadPreserveScrollPos&&n.isChromium&&n.$html.scrollTop(e),setTimeout((function(){t.removeClass("hide")}),300),n.$shopBrowseWrap.hasClass("products-loaded")||n.$shopBrowseWrap.addClass("products-loaded");var d=i.find(".woocommerce-result-count");d.length&&l.children(".woocommerce-result-count").replaceWith(d),(s=i.find(".nm-infload-link").children("a").attr("href"))?r.attr("href",s):(n.$shopBrowseWrap.addClass("all-products-loaded"),n.infloadScroll?n.infscrollLock=!0:l.addClass("hide-btn"),r.removeAttr("href")),n.shopAjax=!1,n.infloadScroll&&n.$window.trigger("scroll"),n.$document.trigger("nm_infload_after",t)}})):n.infloadScroll&&(n.infscrollLock=!0)}}),o.nmThemeExtensions.infload=o.nmTheme.infload_init}(jQuery);